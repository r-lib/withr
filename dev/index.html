<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Run Code With Temporarily Modified Global State • withr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Run Code With Temporarily Modified Global State">
<meta name="description" content="A set of functions to run code with safely and temporarily modified global state. Many of these functions were originally a part of the devtools package, this provides a simple package with limited dependencies to provide access to these functions.">
<meta property="og:description" content="A set of functions to run code with safely and temporarily modified global state. Many of these functions were originally a part of the devtools package, this provides a simple package with limited dependencies to provide access to these functions.">
<meta property="og:image" content="https://withr.r-lib.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="withr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">withr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.0.2.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/withr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/01/withr-3-0-0/">Version 3.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2017/11/withr-2.1.0/">Version 2.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/withr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="withr---run-code-with-modified-state-">withr - run code ‘with’ modified state <a class="anchor" aria-label="anchor" href="#withr---run-code-with-modified-state-"></a>
</h1>
</div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>A set of functions to run code with safely and temporarily modified global state, withr makes working with the global state, i.e. side effects, less error-prone.</p>
<p>Pure functions, such as the <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> function, are easy to understand and reason about: they always map the same input to the same output and have no other impact on the workspace. In other words, pure functions have no <em>side effects</em>: they are not affected by, nor do they affect, the global state in any way apart from the value they return.</p>
<p>The behavior of some functions <em>is</em> affected by the global state. Consider the <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code> function: it takes a filename as an input and returns the contents as an output. In this case, the output depends on the contents of the file; i.e. the output is affected by the global state. Functions like this deal with side effects.</p>
<p>The purpose of the withr package is to help you manage side effects in your code. You may want to run code with secret information, such as an API key, that you store as an environment variable. You may also want to run code with certain options, with a given random-seed, or with a particular working-directory.</p>
<p>The withr package helps you manage these situations, and more, by providing functions to modify the global state temporarily, and safely. These functions modify one of the global settings for duration of a block of code, then automatically reset it after the block is completed.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Install the latest version with:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"withr"</span><span class="op">)</span></span></code></pre></div>
<p>Many of these functions were originally a part of the <a href="https://github.com/r-lib/devtools" class="external-link">devtools</a> package, this provides a simple package with limited dependencies to provide access to these functions.</p>
<ul>
<li>
<code><a href="reference/with_collate.html">with_collate()</a></code> / <code><a href="reference/with_collate.html">local_collate()</a></code> - collation order</li>
<li>
<code><a href="reference/with_dir.html">with_dir()</a></code> / <code><a href="reference/with_dir.html">local_dir()</a></code> - working directory</li>
<li>
<code><a href="reference/with_envvar.html">with_envvar()</a></code> / <code><a href="reference/with_envvar.html">local_envvar()</a></code> - environment variables</li>
<li>
<code><a href="reference/with_libpaths.html">with_libpaths()</a></code> / <code><a href="reference/with_libpaths.html">local_libpaths()</a></code> - library paths</li>
<li>
<code><a href="reference/with_locale.html">with_locale()</a></code> / <code><a href="reference/with_locale.html">local_locale()</a></code> - any locale setting</li>
<li>
<code><a href="reference/with_makevars.html">with_makevars()</a></code> / <code><a href="reference/with_makevars.html">local_makevars()</a></code> / <code><a href="reference/set_makevars.html">set_makevars()</a></code> - makevars variables</li>
<li>
<code><a href="reference/with_options.html">with_options()</a></code> / <code><a href="reference/with_options.html">local_options()</a></code> - options</li>
<li>
<code><a href="reference/with_par.html">with_par()</a></code> / <code><a href="reference/with_par.html">local_par()</a></code> - graphics parameters</li>
<li>
<code><a href="reference/with_path.html">with_path()</a></code> / <code><a href="reference/with_path.html">local_path()</a></code> - PATH environment variable</li>
<li>
<code>with_*()</code> and <code>local_*()</code> functions for the built in R devices, <code>bmp</code>, <code>cairo_pdf</code>, <code>cairo_ps</code>, <code>pdf</code>, <code>postscript</code>, <code>svg</code>, <code>tiff</code>, <code>xfig</code>, <code>png</code>, <code>jpeg</code>.</li>
<li>
<code><a href="reference/with_connection.html">with_connection()</a></code> / <code><a href="reference/with_connection.html">local_connection()</a></code> - R file connections</li>
<li>
<code><a href="reference/with_db_connection.html">with_db_connection()</a></code> / <code><a href="reference/with_db_connection.html">local_db_connection()</a></code> - DB connections</li>
<li>
<code><a href="reference/with_package.html">with_package()</a></code> / <code><a href="reference/with_package.html">local_package()</a></code>, <code><a href="reference/with_package.html">with_namespace()</a></code> / <code><a href="reference/with_package.html">local_namespace()</a></code> and <code><a href="reference/with_package.html">with_environment()</a></code> / <code><a href="reference/with_package.html">local_environment()</a></code> - to run code with modified object search paths.</li>
<li>
<code><a href="reference/with_tempfile.html">with_tempfile()</a></code> / <code><a href="reference/with_tempfile.html">local_tempfile()</a></code> - create and clean up a temp file.</li>
<li>
<code><a href="reference/with_file.html">with_file()</a></code> / <code><a href="reference/with_file.html">local_file()</a></code> - create and clean up a normal file.</li>
<li>
<code><a href="reference/with_sink.html">with_message_sink()</a></code> / <code><a href="reference/with_sink.html">local_message_sink()</a></code> - divert message</li>
<li>
<code><a href="reference/with_sink.html">with_output_sink()</a></code> / <code><a href="reference/with_sink.html">local_output_sink()</a></code> - divert output</li>
<li>
<code><a href="reference/with_seed.html">with_preserve_seed()</a></code> / <code><a href="reference/with_seed.html">with_seed()</a></code>- specify seeds</li>
<li>
<code><a href="reference/with_temp_libpaths.html">with_temp_libpaths()</a></code> / <code><a href="reference/with_temp_libpaths.html">local_temp_libpaths()</a></code> - library paths</li>
<li>
<code><a href="reference/defer.html">defer()</a></code> / <code><a href="reference/defer.html">defer_parent()</a></code> - defer</li>
<li>
<code><a href="reference/with_timezone.html">with_timezone()</a></code> / <code><a href="reference/with_timezone.html">local_timezone()</a></code> - timezones</li>
<li>
<code><a href="reference/with_rng_version.html">with_rng_version()</a></code> / <code><a href="reference/with_rng_version.html">local_rng_version()</a></code> - random number generation version</li>
</ul>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>There are two sets of functions, those prefixed with <code>with_</code> and those with <code>local_</code>. The former reset their state as soon as the <code>code</code> argument has been evaluated. The latter reset when they reach the end of their scope, usually at the end of a function body.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"col"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">new</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="reference/with_par.html">with_par</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">hp</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">wt</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"col"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co">#&gt; [1] "black"</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">par</span>(<span class="st">"col"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1] "black"</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">local_envvar</span>(<span class="fu">c</span>(<span class="st">"WITHR"</span> <span class="ot">=</span> <span class="dv">2</span>))</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="fu">Sys.getenv</span>(<span class="st">"WITHR"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; [1] "2"</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="fu">Sys.getenv</span>(<span class="st">"WITHR"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; [1] ""</span></span></code></pre></div>
<p>There are also <code><a href="reference/with_.html">with_()</a></code> and <code><a href="reference/with_.html">local_()</a></code> functions to construct new <code>with_*</code> and <code>local_*</code> functions if needed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"WITHR"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="fu"><a href="reference/with_envvar.html">with_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WITHR"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"WITHR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"WITHR"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span></span>
<span><span class="fu"><a href="reference/with_envvar.html">with_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="reference/with_envvar.html">with_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"suffix"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1 2"</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h1>
<ul>
<li><a href="https://github.com/r-lib/devtools" class="external-link">Devtools</a></li>
</ul>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=withr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/r-lib/withr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/r-lib/withr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing withr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.jimhester.com/" class="external-link">Jim Hester</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://github.com/lionel-" class="external-link">Lionel Henry</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li>
<a href="https://krlmlr.info" class="external-link">Kirill Müller</a> <br><small class="roles"> Author </small>  </li>
<li>Kevin Ushey <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://hadley.nz" class="external-link">Hadley Wickham</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://github.com/wch" class="external-link">Winston Chang</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://app.codecov.io/gh/r-lib/withr?branch=main" class="external-link"><img src="https://codecov.io/gh/r-lib/withr/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://www.r-pkg.org/pkg/withr" class="external-link"><img src="https://www.r-pkg.org/badges/version/withr" alt="CRAN Version"></a></li>
<li><a href="https://github.com/r-lib/withr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/withr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.jimhester.com/" class="external-link">Jim Hester</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, Kevin Ushey, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
