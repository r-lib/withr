<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run Code With Temporarily Modified Global State • withr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Run Code With Temporarily Modified Global State">
<meta property="og:description" content="A set of functions to run code with safely and
    temporarily modified global state. Many of these functions were
    originally a part of the devtools package, this provides a simple
    package with limited dependencies to provide access to these
    functions.">
<meta property="og:image" content="https://withr.r-lib.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">withr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2017/11/withr-2.1.0/">Version 2.1.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/r-lib/withr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="withr---run-code-with-modified-state-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#withr---run-code-with-modified-state-" class="anchor"></a>withr - run code ‘with’ modified state <img src="reference/figures/logo.png" align="right">
</h1></div>
<!-- badges: start -->

<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>A set of functions to run code with safely and temporarily modified global state, withr makes working with the global state, i.e. side effects, less error-prone.</p>
<p>Pure functions, such as the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function, are easy to understand and reason about: they always map the same input to the same output and have no other impact on the workspace. In other words, pure functions have no <em>side effects</em>: they are not affected by, nor do they affect, the global state in any way apart from the value they return.</p>
<p>The behavior of some functions <em>is</em> affected by the global state. Consider the <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> function: it takes a filename as an input and returns the contents as an output. In this case, the output depends on the contents of the file; i.e. the output is affected by the global state. Functions like this deal with side effects.</p>
<p>The purpose of the withr package is to help you manage side effects in your code. You may want to run code with secret information, such as an API key, that you store as an environment variable. You may also want to run code with certain options, with a given random-seed, or with a particular working-directory.</p>
<p>The withr package helps you manage these situations, and more, by providing functions to modify the global state temporarily, and safely. These functions modify one of the global settings for duration of a block of code, then automatically reset it after the block is completed.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">#Install the latest version with:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"withr"</span>)
</pre></div>
<p>Many of these functions were originally a part of the <a href="https://github.com/hadley/devtools">devtools</a> package, this provides a simple package with limited dependencies to provide access to these functions.</p>
<ul>
<li>
<code><a href="reference/with_collate.html">with_collate()</a></code> / <code><a href="reference/with_collate.html">local_collate()</a></code> - collation order</li>
<li>
<code><a href="reference/with_dir.html">with_dir()</a></code> / <code><a href="reference/with_dir.html">local_dir()</a></code> - working directory</li>
<li>
<code><a href="reference/with_envvar.html">with_envvar()</a></code> / <code><a href="reference/with_envvar.html">local_envvar()</a></code> - environment variables</li>
<li>
<code><a href="reference/with_libpaths.html">with_libpaths()</a></code> / <code><a href="reference/with_libpaths.html">local_libpaths()</a></code> - library paths</li>
<li>
<code><a href="reference/with_locale.html">with_locale()</a></code> / <code><a href="reference/with_locale.html">local_locale()</a></code> - any locale setting</li>
<li>
<code><a href="reference/with_makevars.html">with_makevars()</a></code> / <code><a href="reference/with_makevars.html">local_makevars()</a></code> / <code><a href="reference/set_makevars.html">set_makevars()</a></code> - makevars variables</li>
<li>
<code><a href="reference/with_options.html">with_options()</a></code> / <code><a href="reference/with_options.html">local_options()</a></code> - options</li>
<li>
<code><a href="reference/with_par.html">with_par()</a></code> / <code><a href="reference/with_par.html">local_par()</a></code> - graphics parameters</li>
<li>
<code><a href="reference/with_path.html">with_path()</a></code> / <code><a href="reference/with_path.html">local_path()</a></code> - PATH environment variable</li>
<li>
<code>with_*()</code> and <code>local_*()</code> functions for the built in R devices, <code>bmp</code>, <code>cairo_pdf</code>, <code>cairo_ps</code>, <code>pdf</code>, <code>postscript</code>, <code>svg</code>, <code>tiff</code>, <code>xfig</code>, <code>png</code>, <code>jpeg</code>.</li>
<li>
<code><a href="reference/with_connection.html">with_connection()</a></code> / <code><a href="reference/with_connection.html">local_connection()</a></code> - R file connections</li>
<li>
<code><a href="reference/with_db_connection.html">with_db_connection()</a></code> / <code><a href="reference/with_db_connection.html">local_db_connection()</a></code> - DB conections</li>
<li>
<code><a href="reference/with_package.html">with_package()</a></code> / <code><a href="reference/with_package.html">local_package()</a></code>, <code><a href="reference/with_package.html">with_namespace()</a></code> / <code><a href="reference/with_package.html">local_namespace()</a></code> and <code><a href="reference/with_package.html">with_environment()</a></code> / <code><a href="reference/with_package.html">local_environment()</a></code>
<ul>
<li>to run code with modified object search paths.</li>
</ul>
</li>
<li>
<code><a href="reference/with_tempfile.html">with_tempfile()</a></code> / <code><a href="reference/with_tempfile.html">local_tempfile()</a></code> - create and clean up a temp file.</li>
<li>
<code><a href="reference/with_file.html">with_file()</a></code> / <code><a href="reference/with_file.html">local_file()</a></code> - create and clean up a normal file.</li>
<li>
<code><a href="reference/with_sink.html">with_message_sink()</a></code> / <code><a href="reference/with_sink.html">local_message_sink()</a></code> - divert message</li>
<li>
<code><a href="reference/with_sink.html">with_output_sink()</a></code> / <code><a href="reference/with_sink.html">local_output_sink()</a></code> - divert output</li>
<li>
<code><a href="reference/with_seed.html">with_preserve_seed()</a></code> / <code><a href="reference/with_seed.html">with_seed()</a></code>- specify seeds</li>
<li>
<code><a href="reference/with_temp_libpaths.html">with_temp_libpaths()</a></code> / <code><a href="reference/with_temp_libpaths.html">local_temp_libpaths()</a></code> - library paths</li>
<li>
<code><a href="reference/defer.html">defer()</a></code> / <code><a href="reference/defer.html">defer_parent()</a></code> - defer</li>
<li>
<code><a href="reference/with_timezone.html">with_timezone()</a></code> / <code><a href="reference/with_timezone.html">local_timezone()</a></code> - timezones</li>
<li>
<code><a href="reference/with_rng_version.html">with_rng_version()</a></code> / <code><a href="reference/with_rng_version.html">local_rng_version()</a></code> - random number generation version</li>
</ul>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>There are two sets of functions, those prefixed with <code>with_</code> and those with <code>local_</code>. The former reset their state as soon as the <code>code</code> argument has been evaluated. The latter reset when they reach the end of their scope, usually at the end of a function body.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="st">"col"</span> = <span class="st">"black"</span>)
<span class="kw">my_plot</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">new</span>) {
  <span class="fu"><a href="reference/with_par.html">with_par</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(col = <span class="st">"red"</span>, pch = <span class="fl">19</span>),
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">mtcars</span><span class="op">$</span><span class="kw">hp</span>, <span class="kw">mtcars</span><span class="op">$</span><span class="kw">wt</span>)
  )
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="st">"col"</span>)
}
<span class="fu">my_plot</span>()
</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">#&gt; [1] "black"</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">par</span>(<span class="st">"col"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; [1] "black"</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="kw">local_envvar</span>(<span class="kw">c</span>(<span class="st">"WITHR"</span> =<span class="st"> </span><span class="dv">2</span>))</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="kw">Sys.getenv</span>(<span class="st">"WITHR"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>}</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="kw">f</span>()</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; [1] "2"</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="kw">Sys.getenv</span>(<span class="st">"WITHR"</span>)</span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; [1] ""</span></span></code></pre></div>
<p>There are also <code><a href="reference/local_.html">with_()</a></code> and <code><a href="reference/local_.html">local_()</a></code> functions to construct new <code>with_*</code> and <code>local_*</code> functions if needed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"WITHR"</span>)
<span class="co">#&gt; [1] ""</span>
<span class="fu"><a href="reference/with_envvar.html">with_envvar</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"WITHR"</span> = <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"WITHR"</span>))
<span class="co">#&gt; [1] "2"</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"WITHR"</span>)
<span class="co">#&gt; [1] ""</span>

<span class="fu"><a href="reference/with_envvar.html">with_envvar</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span> = <span class="fl">1</span>),
  <span class="fu"><a href="reference/with_envvar.html">with_envvar</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span> = <span class="fl">2</span>), action = <span class="st">"suffix"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"A"</span>))
)
<span class="co">#&gt; [1] "1 2"</span>
</pre></div>
</div>
</div>
<div id="see-also" class="section level1">
<h1 class="hasAnchor">
<a href="#see-also" class="anchor"></a>See Also</h1>
<ul>
<li><a href="https://github.com/hadley/devtools">Devtools</a></li>
</ul>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=withr">https://​cloud.r-project.org/​package=withr</a>
</li>
<li>Browse source code at <br><a href="http://github.com/r-lib/withr/">http://​github.com/​r-lib/​withr/​</a>
</li>
<li>Report a bug at <br><a href="http://github.com/r-lib/withr/issues">http://​github.com/​r-lib/​withr/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://jimhester.com">Jim Hester</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li>Kirill Müller <br><small class="roles"> Author </small>  </li>
<li>Kevin Ushey <br><small class="roles"> Author </small>  </li>
<li>
<a href="http://hadley.nz">Hadley Wickham</a> <br><small class="roles"> Author </small>  </li>
<li>Winston Chang <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/r-lib/withr/actions"><img src="https://github.com/r-lib/withr/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/r-lib/withr?branch=master"><img src="https://codecov.io/gh/r-lib/withr/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="http://www.r-pkg.org/pkg/withr"><img src="http://www.r-pkg.org/badges/version/withr" alt="CRAN Version"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://jimhester.com">Jim Hester</a>, Kirill Müller, Kevin Ushey, <a href="http://hadley.nz">Hadley Wickham</a>, Winston Chang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
